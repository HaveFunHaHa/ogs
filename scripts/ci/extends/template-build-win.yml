.template-build-win:
  stage: build
  tags:
    - windows
  extends:
    - .vs2019-environment
    - .test-artifacts
  dependencies: [meta, meta_container]
  variables:
  script:
    - $build_directory = if ($env:BUILD_DIR) { $env:BUILD_DIR } else { "build/" + $env:CMAKE_PRESET }
    - $cmake_cmd = "cmake -S . --preset=$env:CMAKE_PRESET
      $env:CMAKE_ARGS
      -DOGS_BUILD_PROCESSES=$env:BUILD_PROCESSES"
    - $cmake_cmd
    - Invoke-Expression $cmake_cmd
    - cd $build_directory
    - cmake --build . --target package | Tee-Object -FilePath make.output
    - if($env:BUILD_TESTS -eq "true") { cmake --build . --target tests }
    - if($env:BUILD_CTEST -eq "true") { cmake --build . --target ctest }
    - if($env:BUILD_CTEST -eq "true") { cp Testing/**/Test.xml Tests/ctest.xml }
